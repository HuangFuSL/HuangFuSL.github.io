# Python中的映射类型

Python中最常见的映射类型是字典。本文将从字典入手对Python中的映射类型进行探讨。

## 字典

字典类型`dict`对应的抽象基类为`MutableMapping`。而`MutableMapping`是`Mapping`的子类。

`dict`中的数据组织为键-值对的形式，字典对值的类型没有要求，但要求键的类型必须可散列（hashable）。由此可见，字典结构的底层实现类似散列表，以加快字典内元素的访问速度。

### 可散列类型

满足如下条件的对象称为可散列对象：

1. 如果该对象可散列，则在其生命周期中，该散列值不变
2. 对象实现了`__hash__()`与`__eq__()`方法
3. 如果它和另一个对象相等，则两者有相同的散列值

如：

```python
>>> a = "abc"
>>> b = "".join(["a", "b", "c"])
>>> a is b
False
>>> hash(a) == hash(b)
True
>>>
```

根据如上规则可以判断一些内置数据结构是否为可散列对象

* 可变序列在生命周期中序列的内容可能发生变化，因此可变序列（如`list`）不是可散列对象。
* 原子不可变数据类型满足如上所有条件，是可散列对象
* 容器`frozenset`要求其中的所有元素均为可散列对象，因此本身是可散列对象
* 容器`tuple`中可以容纳不可散列对象，因此`tuple`不是可散列对象，但不含可散列对象的元组是可散列对象。

```python
>>> t1 = hash((1, 2))
>>> t2 = hash((1, [2]))
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
TypeError: unhashable type: 'list'
>>>
```

### 构造

字典提供了多种构造方式，如下构造字典`{'a': 1, 'b': 2}`

1. 花括号构造，如`{'a': 1, 'b': 2}`
2. 通过类构造函数，如`dict(a=1, b=2)`
3. 通过元组/列表（只需是长度为2的可迭代对象）构造，如`dict([('a', 1), ['b', 2]])`
4. 通过`zip`打包构造，如`dict(zip(['a', 'b'], [1, 2]))`
5. 通过字典推导构造，如`{chr(97 + _): _ + 1 for _ in range(2)}`
